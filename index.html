<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mampara ZA</title>

    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- html2canvas for export -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <style>
        body { background-color: #f3f4f6; font-family: sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const LinkIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round"
         strokeLinejoin="round" className="text-white drop-shadow-2xl">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
    </svg>
);

const monthsList = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
];

const yearsList = [2025, 2026, 2027, 2028];

const DATA_URL =
    'https://raw.githubusercontent.com/CliffortMC08/mampara-za-data/main/content.json';

function App() {
    const [data, setData] = useState({});
    const [selectedYear, setSelectedYear] = useState(2026);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        fetch(DATA_URL)
            .then(res => {
                if (!res.ok) throw new Error('Could not load Mampara moments ðŸ˜¢');
                return res.json();
            })
            .then(json => {
                setData(json);
                setLoading(false);
            })
            .catch(err => {
                setError(err.message);
                setLoading(false);
            });
    }, []);

    const getMonthVideos = (month) =>
        (data[selectedYear]?.[month]) || [];

    /* DOWNLOAD YEAR AS IMAGE */
    const downloadYearAsImage = async () => {
        const element = document.getElementById('year-content');
        if (!element) return;

        const canvas = await html2canvas(element, {
            scale: 2,
            useCORS: true,
            backgroundColor: '#f3f4f6'
        });

        const link = document.createElement('a');
        link.download = `Mampara_ZA_${selectedYear}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    };

    if (loading) {
        return (
            <div className="min-h-screen flex items-center justify-center">
                <p className="text-2xl font-bold text-gray-700">
                    Loading the funniest SA moments...
                </p>
            </div>
        );
    }

    if (error) {
        return (
            <div className="min-h-screen flex items-center justify-center">
                <p className="text-2xl font-bold text-red-600">
                    Error: {error}
                </p>
            </div>
        );
    }

    return (
        <div className="min-h-screen pb-20">

            {/* HEADER */}
            <header className="bg-black text-white py-10 shadow-2xl">
                <div className="container mx-auto px-6 text-center">
                    <h1 className="text-5xl md:text-7xl font-black text-yellow-400">
                        Mampara ZA
                    </h1>
                    <p className="mt-3 text-xl text-green-300">
                        South Africa's Viral Hall of Fame ðŸ‡¿ðŸ‡¦
                    </p>
                </div>
            </header>

            {/* YEAR TABS */}
            <div className="bg-white sticky top-0 z-50 shadow-md">
                <div className="container mx-auto flex justify-center gap-4 py-5 px-6 overflow-x-auto scrollbar-hide">
                    {yearsList.map(year => (
                        <button
                            key={year}
                            onClick={() => setSelectedYear(year)}
                            className={`px-8 py-3 rounded-full font-bold text-lg transition-all ${
                                selectedYear === year
                                    ? 'bg-green-600 text-white shadow-lg'
                                    : 'bg-gray-200 hover:bg-gray-300'
                            }`}
                        >
                            {year}
                        </button>
                    ))}
                </div>
            </div>

            {/* DOWNLOAD BUTTON */}
            <div className="container mx-auto px-6 py-6 flex justify-center">
                <button
                    onClick={downloadYearAsImage}
                    className="px-8 py-3 rounded-full bg-black text-yellow-400
                               font-bold text-lg shadow-lg hover:scale-105 transition-transform"
                >
                    Download {selectedYear} as Image ðŸ“¸
                </button>
            </div>

            {/* YEAR CONTENT (CAPTURED) */}
            <div id="year-content" className="container mx-auto px-6 py-10">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                    {monthsList.map(month => {
                        const videos = getMonthVideos(month);
                        return (
                            <div key={month}
                                 className="bg-white rounded-3xl shadow-xl overflow-hidden flex flex-col">

                                <div className="bg-gradient-to-r from-green-600 via-yellow-400 to-black
                                                text-white px-8 py-6">
                                    <h3 className="text-3xl font-bold">
                                        {month} {selectedYear}
                                    </h3>
                                    {videos.length > 0 && (
                                        <span className="mt-2 inline-block px-4 py-1
                                                         bg-white bg-opacity-30 rounded-full text-sm font-semibold">
                                            {videos.length} mampara moment{videos.length > 1 ? 's' : ''}
                                        </span>
                                    )}
                                </div>

                                <div className="p-6 flex-grow bg-gray-50 overflow-y-auto">
                                    {videos.length > 0 ? (
                                        <div className="grid grid-cols-3 gap-4">
                                            {videos.map((video, idx) => (
                                                <a key={idx}
                                                   href={video.videoLink}
                                                   target="_blank"
                                                   rel="noopener noreferrer"
                                                   className="group relative aspect-square rounded-2xl
                                                              overflow-hidden shadow-lg hover:shadow-2xl transition-all">
                                                    <img
                                                        src={video.thumbnail}
                                                        alt={video.alt || `Viral moment`}
                                                        className="w-full h-full object-cover
                                                                   group-hover:scale-125 transition-transform duration-700"
                                                        loading="lazy"
                                                    />
                                                    <div className="absolute inset-0 bg-black bg-opacity-0
                                                                    group-hover:bg-opacity-50 transition-all
                                                                    flex items-center justify-center">
                                                        <LinkIcon />
                                                    </div>
                                                </a>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="h-full flex flex-col items-center justify-center text-gray-500">
                                            <span className="text-7xl mb-4">ðŸ‡¿ðŸ‡¦</span>
                                            <p className="text-lg font-medium">No mamparas yet...</p>
                                            <p className="text-sm mt-2">The laughs are coming soon!</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </div>
    );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
